#!/bin/bash# Cambiar temporalmente el DNSsed -i 's/127.0.0.1/8.8.8.8/' /etc/resolv.conf# Actualizar el sistemaapt-get update -y && apt-get upgrade -y# Instalar paquetes necesariosapt-get install acl attr samba samba-client winbind libpam-winbind libnss-winbind dnsutils python3-setproctitle -y# Borrar archivos antiguos de Sambafor VARIABLE in $(smbd -b | egrep "LOCKDIR|STATEDIR|CACHEDIR|PRIVATE_DIR" | cut -d ":" -f2)do   echo "Borrando *.tdb y *.ldb en $VARIABLE"   rm -Rf $VARIABLE/*.tdb   rm -Rf $VARIABLE/*.ldbdone# Instalar paquetes adicionalesapt install sssd-tools sssd libnss-sss libpam-sss adcli packagekit sssd-ad sssd-tools realmd -y# Detener y deshabilitar servicios innecesariossystemctl stop smbd nmbd winbindsystemctl disable smbd nmbd winbind# Provisionar Samba ADsamba-tool domain provision --server-role=dc --use-rfc2307 --dns-backend=SAMBA_INTERNAL --realm=MRAI-TIPY-UY.DUCKDNS.ORG --domain=MRAI-TIPY --adminpass=Passw0rd# Restaurar el archivo resolv.confsed -i 's/8.8.8.8/127.0.0.1/' /etc/resolv.conf# Comprobar la configuraciÃ³n del DNShost -t SRV _ldap._tcp.MRAI-TIPY-UY.DUCKDNS.ORGhost -t SRV _kerberos._udp.MRAI-TIPY-UY.DUCKDNS.ORGhost -t A 1-MR-addc01.mrai-tipy-uy.duckdns.org# Reiniciar y habilitar Sambasystemctl restart samba-ad-dcsystemctl enable samba-ad-dc